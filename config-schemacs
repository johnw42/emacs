#! /bin/bash

with=${1-with}
shift

autoreconf

if [[ $with == with ]]; then
  CFLAGS='-O0 -finline-functions -g -Werror=implicit-function-declaration -Werror=nested-externs'
  checking=yes
  cannot_dump=yes
else
  CFLAGS=
  checking=no
  cannot_dump=no
fi

./configure --enable-checking=$checking --$with-chez-scheme --without-makeinfo AM_DEFAULT_VERBOSITY=0 CANNOT_DUMP=$cannot_dump CFLAGS="$CFLAGS" "$@"
